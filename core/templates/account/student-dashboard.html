{% extends 'base_dashboard.html' %}

{% block title %}Student Dashboard - NOCEN DSSN{% endblock %}

{% block page_title_mobile %}Dashboard{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div class="bg-gradient-to-r from-primary to-primary-dark rounded-2xl p-6 md:p-8 text-white">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold mb-2">Welcome back, {{ student_name|default:"Student" }}!</h1>
            <p class="text-white/80">Here's an overview of your academic progress.</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-center">
                <p class="text-3xl font-bold">{{ student_class }}</p>
                <p class="text-sm text-white/70">Class</p>
            </div>
            <div class="w-px h-12 bg-white/30"></div>
            <div class="text-center">
                <p class="text-3xl font-bold">{{ current_term|default:"-" }}</p>
                <p class="text-sm text-white/70">Term</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-white dark:bg-surface-dark rounded-xl p-5 border border-border-color dark:border-[#2d3748]">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600">
                <span class="material-symbols-outlined">school</span>
            </div>
            <div>
                <p class="text-text-sub text-sm">Average Score</p>
                <p class="text-text-main dark:text-white text-xl font-bold">{{ avg_score }}%</p>
            </div>
        </div>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-5 border border-border-color dark:border-[#2d3748]">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-primary">
                <span class="material-symbols-outlined">calendar_month</span>
            </div>
            <div>
                <p class="text-text-sub text-sm">Attendance</p>
                <p class="text-text-main dark:text-white text-xl font-bold">{{ attendance_rate }}%</p>
            </div>
        </div>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-5 border border-border-color dark:border-[#2d3748]">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600">
                <span class="material-symbols-outlined">menu_book</span>
            </div>
            <div>
                <p class="text-text-sub text-sm">Subjects</p>
                <p class="text-text-main dark:text-white text-xl font-bold">{{ total_subjects }}</p>
            </div>
        </div>
    </div>
    <div class="bg-white dark:bg-surface-dark rounded-xl p-5 border border-border-color dark:border-[#2d3748]">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-600">
                <span class="material-symbols-outlined">emoji_events</span>
            </div>
            <div>
                <p class="text-text-sub text-sm">Class Position</p>
                <p class="text-text-main dark:text-white text-xl font-bold">{{ position }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- View Results Card -->
    <a href="{% url 'student_result' %}" class="bg-white dark:bg-surface-dark rounded-xl p-6 border border-border-color dark:border-[#2d3748] hover:border-primary/50 hover:shadow-lg transition-all group">
        <div class="flex items-center gap-4">
            <div class="p-3 bg-primary/10 rounded-xl text-primary group-hover:bg-primary group-hover:text-white transition-colors">
                <span class="material-symbols-outlined text-3xl">assignment</span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-text-main dark:text-white">View Results</h3>
                <p class="text-sm text-text-sub">Check your termly results</p>
            </div>
        </div>
    </a>
    
    <!-- Timetable Card -->
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 border border-border-color dark:border-[#2d3748] hover:border-primary/50 hover:shadow-lg transition-all group cursor-pointer">
        <div class="flex items-center gap-4">
            <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-xl text-green-600 group-hover:bg-green-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined text-3xl">schedule</span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-text-main dark:text-white">Timetable</h3>
                <p class="text-sm text-text-sub">View class schedule</p>
            </div>
        </div>
    </div>
    
    <!-- Fee Status Card -->
    <div class="bg-white dark:bg-surface-dark rounded-xl p-6 border border-border-color dark:border-[#2d3748] hover:border-primary/50 hover:shadow-lg transition-all group cursor-pointer">
        <div class="flex items-center gap-4">
            <div class="p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl text-orange-600 group-hover:bg-orange-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined text-3xl">payments</span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-text-main dark:text-white">Fee Status</h3>
                <p class="text-sm text-text-sub">Check payment status</p>
            </div>
        </div>
    </div>
    
    <!-- Buy Pin Card -->
    <a href="{% url 'buy_pin_page' %}" class="bg-white dark:bg-surface-dark rounded-xl p-6 border border-border-color dark:border-[#2d3748] hover:border-primary/50 hover:shadow-lg transition-all group">
        <div class="flex items-center gap-4">
            <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-xl text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined text-3xl">vpn_key</span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-text-main dark:text-white">Buy Result Pin</h3>
                <p class="text-sm text-text-sub">Purchase pin for results</p>
            </div>
        </div>
    </a>
</div>

<!-- Pending Payment Alert -->
{% if pending_payments %}
<div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800/30 rounded-xl p-4 flex items-start gap-3">
    <span class="material-symbols-outlined text-amber-500 shrink-0">hourglass_top</span>
    <div class="flex-1">
        <h4 class="font-bold text-amber-800 dark:text-amber-400 mb-1">Payment Under Review</h4>
        <p class="text-sm text-amber-700 dark:text-amber-300/80">You have {{ pending_payments.count }} pending payment(s) awaiting approval.</p>
    </div>
    <a href="{% url 'payment_pending' %}" class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-bold text-sm transition-colors whitespace-nowrap">
        View Status
    </a>
</div>
{% endif %}

<!-- My Result PINs -->
{% if pins %}
<div class="bg-white dark:bg-surface-dark rounded-xl border border-border-color dark:border-[#2d3748]">
    <div class="p-4 border-b border-border-color dark:border-[#2d3748] flex justify-between items-center">
        <h3 class="text-lg font-bold text-text-main dark:text-white flex items-center gap-2">
            <span class="material-symbols-outlined text-primary">key</span>
            My Result PINs
        </h3>
        <a href="{% url 'buy_pin_page' %}" class="text-primary text-sm font-medium hover:underline flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">add</span>
            Buy New
        </a>
    </div>
    <div class="divide-y divide-border-color dark:divide-[#2d3748]">
        {% for pin in pins %}
        <div class="p-4 hover:bg-gray-50 dark:hover:bg-[#2d3748] transition-colors">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="size-10 rounded-lg flex items-center justify-center {% if pin.status == 'active' %}bg-green-100 dark:bg-green-900/30 text-green-600{% else %}bg-gray-100 dark:bg-gray-800 text-gray-400{% endif %}">
                        <span class="material-symbols-outlined">{% if pin.status == 'active' %}vpn_key{% else %}vpn_key_off{% endif %}</span>
                    </div>
                    <div>
                        <p class="font-mono font-bold text-text-main dark:text-white text-lg tracking-wide">{{ pin.code }}</p>
                        <p class="text-xs text-text-sub">{{ pin.term.name }} - {{ pin.academic_session.name }}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="px-2 py-1 rounded-full text-xs font-bold {% if pin.status == 'active' %}bg-green-100 dark:bg-green-900/30 text-green-600{% else %}bg-gray-100 dark:bg-gray-800 text-gray-500{% endif %}">
                        {{ pin.status|title }}
                    </span>
                    <button onclick="copyPin('{{ pin.code }}')" class="size-8 rounded-lg bg-gray-100 dark:bg-gray-800 text-text-sub hover:text-primary hover:bg-primary/10 flex items-center justify-center transition-colors" title="Copy PIN">
                        <span class="material-symbols-outlined text-lg">content_copy</span>
                    </button>
                    {% if pin.status == 'active' %}
                    <a href="{% url 'student_result' %}?pin_code={{ pin.code }}&term_id={{ pin.term.id }}" class="size-8 rounded-lg bg-primary/10 text-primary hover:bg-primary hover:text-white flex items-center justify-center transition-colors" title="Check Result">
                        <span class="material-symbols-outlined text-lg">visibility</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Recent Announcements -->
<div class="bg-white dark:bg-surface-dark rounded-xl border border-border-color dark:border-[#2d3748]">
    <div class="p-4 border-b border-border-color dark:border-[#2d3748] flex justify-between items-center">
        <h3 class="text-lg font-bold text-text-main dark:text-white">Recent Announcements</h3>
        <a href="#" class="text-primary text-sm font-medium hover:underline">View All</a>
    </div>
    <div class="divide-y divide-border-color dark:divide-[#2d3748]">
        <div class="p-4 hover:bg-gray-50 dark:hover:bg-[#2d3748] transition-colors">
            <div class="flex items-start gap-3">
                <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-primary shrink-0">
                    <span class="material-symbols-outlined">campaign</span>
                </div>
                <div>
                    <h4 class="font-semibold text-text-main dark:text-white">Mid-Term Break Notice</h4>
                    <p class="text-sm text-text-sub mt-1">School will be on mid-term break from February 15-19, 2024.</p>
                    <p class="text-xs text-text-sub mt-2">Posted 2 days ago</p>
                </div>
            </div>
        </div>
        <div class="p-4 hover:bg-gray-50 dark:hover:bg-[#2d3748] transition-colors">
            <div class="flex items-start gap-3">
                <div class="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600 shrink-0">
                    <span class="material-symbols-outlined">sports_soccer</span>
                </div>
                <div>
                    <h4 class="font-semibold text-text-main dark:text-white">Inter-House Sports Competition</h4>
                    <p class="text-sm text-text-sub mt-1">Annual inter-house sports will hold on March 15, 2024.</p>
                    <p class="text-xs text-text-sub mt-2">Posted 5 days ago</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="fixed bottom-6 right-6 bg-gray-900 text-white px-4 py-3 rounded-xl shadow-2xl flex items-center gap-3 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
    <span class="material-symbols-outlined text-green-400">check_circle</span>
    <span id="toast-message">Copied to clipboard!</span>
</div>

<script>
    function showToast(message) {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        toastMessage.textContent = message;
        toast.classList.remove('translate-y-20', 'opacity-0');
        toast.classList.add('translate-y-0', 'opacity-100');
        
        setTimeout(() => {
            toast.classList.add('translate-y-20', 'opacity-0');
            toast.classList.remove('translate-y-0', 'opacity-100');
        }, 3000);
    }
    
    function copyPin(code) {
        navigator.clipboard.writeText(code);
        showToast('PIN copied to clipboard!');
    }
</script>
{% endblock %}
